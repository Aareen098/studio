/**
 * @fileoverview Firestore Security Rules for the application.
 *
 * Core Philosophy:
 * This ruleset secures contact form submissions by allowing only authenticated administrators to view all submissions.
 * Unauthenticated users are not able to list or get any submissions.
 *
 * Data Structure:
 * Contact form submissions are stored in the top-level `/contactFormSubmissions/{contactFormSubmissionId}` collection.
 *
 * Key Security Decisions:
 * - Unauthenticated users cannot list or get any documents.
 * - Only authenticated users (assumed to be administrators) can view submissions.
 * - Data validation is relaxed in this prototyping phase, focusing on access control rather than schema enforcement.
 * - User listing is disallowed.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to contact form submissions. Only authenticated administrators can view submissions.
     * @path /contactFormSubmissions/{contactFormSubmissionId}
     * @allow (get, list) - Authenticated administrator can view submissions.
     *   auth.uid: "admin123"
     *   operation: get
     * @allow (create, update, delete) - Authenticated administrator can create, update, and delete submissions.
     *   auth.uid: "admin123"
     *   operation: create
     * @deny (get, list) - Unauthenticated user cannot view submissions.
     *   auth: null
     *   operation: get
     * @deny (create, update, delete) - Unauthenticated user cannot create submissions.
     *   auth: null
     *   operation: create
     * @principle Authenticated administrators only can manage contact form submissions.
     */
    match /contactFormSubmissions/{contactFormSubmissionId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    // --- Helper Functions ---

    /**
     * @description Checks if the user is signed in (authenticated).
     * @return {bool} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }
  }
}